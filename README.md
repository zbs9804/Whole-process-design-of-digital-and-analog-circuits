Code Description:
First of all, the input clock of the module must be 0.1 second instead of 1 second. This has the advantages of speeding up the response speed of the induction lamp, and facilitating the timer to count decimal places. If the input clock period is not 100ms, an external frequency divider is needed, otherwise the unit of lighting time in corridor will not be in seconds.
When the stimulus duration is more than 0.3 seconds but less than 6 seconds, the light is on for three seconds. In the aspect of program implementation, two timers are used, timer is used to count the time when the stimulus signal appears, lghttime is used to time the light on, and two registers counter and counter 3S are used for timing. The function of counter is to generate a control signal to turn off the light of this layer after 0.5 seconds countdown when the energy-saving mode is on; the function of counter 3S is to save the stimulus signal When it is more than 6 seconds and disappears, the countdown starts for three seconds and a control signal is generated to turn off the lights on the floor. After the light is turned off, all relevant registers will be cleared and all control signals will be reset to prevent the next use.
Among them, the realization of energy-saving mode can not be triggered by level information, but must be realized by using rising edge trigger. This is because only when the light of this floor is on, the lighting condition of adjacent floors can be monitored. When the lights of adjacent floors are on, it means that pedestrians have walked from this floor to adjacent floors, and then the lights of this floor can be turned off. If level sensitivity is used to control the switch signal of energy-saving mode, it will be impossible to distinguish which floor the pedestrian goes to first and then to which floor, thus it is impossible to determine which floor will enter the energy-saving mode.
